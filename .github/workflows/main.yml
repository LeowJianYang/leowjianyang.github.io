name: Deploy React (Vite + pnpm) to GitHub Pages

on:
  push:
    branches: [ "main" ]

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 8
          run_install: true  

      - name: Build project
        run: pnpm run build

      - name: Create Redirect Pages
        run: |
        
          mkdir -p dist/Portfolio
          cat <<EOF > dist/Portfolio/index.html
          <!DOCTYPE html>
          <html>
          <head>
            <meta http-equiv="refresh" content="0; url=/" />
          </head>
          <body>
            <p>Page moved: <a href="/">Home</a></p>
          </body>
          </html>
          EOF

         
          # mkdir -p dist/legacy
          # cat <<EOF > dist/legacy/index.html
          # <!DOCTYPE html>
          # <html>
          # <head>
          #   <meta http-equiv="refresh" content="0; url=https://example.com" />
          # </head>
          # <body>
          #   <p>Page moved: <a href="https://example.com">https://example.com</a></p>
          # </body>
          # </html>
          # EOF

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          publish_branch: gh-pages
